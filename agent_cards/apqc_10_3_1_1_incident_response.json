{
  "apqc_id": "10.3.1.1",
  "apqc_name": "Manage incident response and remediation",
  "category": "10.0 - Manage Enterprise Risk, Compliance, Remediation, & Resiliency",
  "description": "End-to-end incident response workflow from detection through resolution and post-incident review, including triage, containment, eradication, recovery, and lessons learned.",
  "orchestration_pattern": "sequential",
  "total_steps": 7,
  "estimated_duration_seconds": 172800,
  "compliance_frameworks": ["NIST CSF", "ISO 27001", "SOC2", "PCI-DSS", "HIPAA"],
  "data_retention_days": 2555,

  "agent_cards": [
    {
      "id": "agent_10_3_1_1_step1",
      "apqc_id": "10.3.1.1",
      "step_number": 1,
      "step_name": "Incident Detection & Logging",
      "description": "Detect, log, and categorize security and operational incidents",
      "purpose": "Capture all incidents",
      "business_value": "Comprehensive incident visibility",

      "capabilities": ["alert_processing", "incident_logging", "auto_categorization", "priority_assignment", "correlation_analysis"],

      "input_schema": [
        {"name": "alert_source", "type": "string", "required": true},
        {"name": "alert_details", "type": "object", "required": true},
        {"name": "affected_systems", "type": "array", "required": true},
        {"name": "detection_timestamp", "type": "string", "required": true}
      ],

      "output_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "incident_category", "type": "string", "required": true},
        {"name": "severity_level", "type": "string", "required": true, "validation": {"enum": ["critical", "high", "medium", "low"]}},
        {"name": "initial_assessment", "type": "object", "required": true}
      ],

      "required_integrations": [
        {"system": "SIEM", "type": "read", "protocol": "API", "examples": ["Splunk", "Microsoft Sentinel", "IBM QRadar"]},
        {"system": "ITSM", "type": "bidirectional", "protocol": "API", "examples": ["ServiceNow", "Jira Service Management"]},
        {"system": "EDR", "type": "read", "protocol": "API", "examples": ["CrowdStrike", "Carbon Black", "SentinelOne"]}
      ],

      "decision_rules": [
        {"rule_id": "DR-ID-001", "name": "Critical Incident", "condition": "severity == 'critical'", "action": "immediate_escalation_and_war_room", "priority": 1},
        {"rule_id": "DR-ID-002", "name": "Data Breach Indicator", "condition": "category == 'data_exfiltration'", "action": "activate_breach_protocol", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "alert_flood", "severity": "high", "action": "enable_rate_limiting", "notification": ["soc_lead"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step2",
      "apqc_id": "10.3.1.1",
      "step_number": 2,
      "step_name": "Triage & Assessment",
      "description": "Assess incident scope, impact, and initial response requirements",
      "purpose": "Understand incident severity",
      "business_value": "Informed response decisions",

      "capabilities": ["impact_analysis", "scope_determination", "stakeholder_identification", "resource_assessment", "timeline_estimation"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "initial_assessment", "type": "object", "required": true},
        {"name": "asset_inventory", "type": "array", "required": true},
        {"name": "business_context", "type": "object", "required": true}
      ],

      "output_schema": [
        {"name": "triage_report", "type": "object", "required": true},
        {"name": "impact_assessment", "type": "object", "required": true},
        {"name": "response_team", "type": "array", "required": true},
        {"name": "estimated_resolution_time", "type": "string", "required": true}
      ],

      "required_integrations": [
        {"system": "ITSM", "type": "bidirectional", "protocol": "API"},
        {"system": "CMDB", "type": "read", "protocol": "API", "examples": ["ServiceNow CMDB", "Device42"]},
        {"system": "Communication", "type": "write", "protocol": "API", "examples": ["PagerDuty", "Slack", "Microsoft Teams"]}
      ],

      "decision_rules": [
        {"rule_id": "DR-TA-001", "name": "Business Critical", "condition": "affected_system.criticality == 'tier1'", "action": "escalate_to_executive", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "missing_asset_data", "severity": "medium", "action": "manual_assessment_required", "notification": ["incident_commander"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step3",
      "apqc_id": "10.3.1.1",
      "step_number": 3,
      "step_name": "Containment",
      "description": "Implement immediate containment measures to limit damage",
      "purpose": "Stop incident spread",
      "business_value": "Damage limitation",

      "capabilities": ["network_isolation", "account_lockout", "system_quarantine", "traffic_blocking", "containment_verification"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "triage_report", "type": "object", "required": true},
        {"name": "containment_options", "type": "array", "required": true},
        {"name": "business_impact_tolerance", "type": "object", "required": true}
      ],

      "output_schema": [
        {"name": "containment_actions", "type": "array", "required": true},
        {"name": "containment_status", "type": "string", "required": true, "validation": {"enum": ["contained", "partially_contained", "not_contained"]}},
        {"name": "business_impact", "type": "object", "required": true},
        {"name": "next_steps", "type": "array", "required": true}
      ],

      "required_integrations": [
        {"system": "SOAR", "type": "bidirectional", "protocol": "API", "examples": ["Splunk SOAR", "Palo Alto XSOAR", "IBM Resilient"]},
        {"system": "Firewall", "type": "write", "protocol": "API", "examples": ["Palo Alto", "Fortinet", "Cisco"]},
        {"system": "IAM", "type": "write", "protocol": "API", "examples": ["Okta", "Azure AD", "CyberArk"]}
      ],

      "decision_rules": [
        {"rule_id": "DR-CO-001", "name": "Full Isolation", "condition": "ransomware_detected OR active_exfiltration", "action": "complete_network_isolation", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "containment_failed", "severity": "critical", "action": "manual_intervention_required", "notification": ["ciso", "incident_commander"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step4",
      "apqc_id": "10.3.1.1",
      "step_number": 4,
      "step_name": "Investigation & Root Cause",
      "description": "Investigate incident to determine root cause and attack vector",
      "purpose": "Understand what happened",
      "business_value": "Prevention of recurrence",

      "capabilities": ["forensic_analysis", "log_analysis", "ioc_extraction", "timeline_reconstruction", "attribution_analysis"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "containment_status", "type": "string", "required": true},
        {"name": "forensic_data", "type": "object", "required": true},
        {"name": "log_sources", "type": "array", "required": true}
      ],

      "output_schema": [
        {"name": "investigation_report", "type": "object", "required": true},
        {"name": "root_cause", "type": "string", "required": true},
        {"name": "attack_vector", "type": "object", "required": true},
        {"name": "indicators_of_compromise", "type": "array", "required": true}
      ],

      "required_integrations": [
        {"system": "SIEM", "type": "read", "protocol": "API"},
        {"system": "Forensics Tool", "type": "bidirectional", "protocol": "API", "examples": ["EnCase", "FTK", "Volatility"]},
        {"system": "Threat Intelligence", "type": "read", "protocol": "API", "examples": ["VirusTotal", "Recorded Future", "Mandiant"]}
      ],

      "decision_rules": [
        {"rule_id": "DR-IN-001", "name": "APT Indicators", "condition": "attack_sophistication == 'high' AND persistence_detected", "action": "engage_external_ir_team", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "evidence_gap", "severity": "high", "action": "expand_collection_scope", "notification": ["forensics_lead"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step5",
      "apqc_id": "10.3.1.1",
      "step_number": 5,
      "step_name": "Eradication",
      "description": "Remove threat actors, malware, and vulnerabilities from environment",
      "purpose": "Eliminate the threat",
      "business_value": "Clean environment",

      "capabilities": ["malware_removal", "vulnerability_patching", "credential_reset", "backdoor_removal", "verification_scanning"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "investigation_report", "type": "object", "required": true},
        {"name": "affected_systems", "type": "array", "required": true},
        {"name": "eradication_plan", "type": "object", "required": true}
      ],

      "output_schema": [
        {"name": "eradication_actions", "type": "array", "required": true},
        {"name": "eradication_status", "type": "string", "required": true},
        {"name": "verification_results", "type": "object", "required": true},
        {"name": "remaining_risks", "type": "array", "required": false}
      ],

      "required_integrations": [
        {"system": "SOAR", "type": "bidirectional", "protocol": "API"},
        {"system": "Patch Management", "type": "bidirectional", "protocol": "API", "examples": ["SCCM", "Tanium", "BigFix"]},
        {"system": "EDR", "type": "bidirectional", "protocol": "API"}
      ],

      "decision_rules": [
        {"rule_id": "DR-ER-001", "name": "Clean Sweep", "condition": "ransomware_incident", "action": "full_system_rebuild", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "eradication_incomplete", "severity": "high", "action": "reimage_systems", "notification": ["incident_commander", "ciso"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step6",
      "apqc_id": "10.3.1.1",
      "step_number": 6,
      "step_name": "Recovery",
      "description": "Restore systems and services to normal operations",
      "purpose": "Resume business operations",
      "business_value": "Business continuity",

      "capabilities": ["system_restoration", "data_recovery", "service_validation", "monitoring_enhancement", "gradual_reconnection"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "eradication_status", "type": "string", "required": true},
        {"name": "recovery_plan", "type": "object", "required": true},
        {"name": "backup_status", "type": "object", "required": true}
      ],

      "output_schema": [
        {"name": "recovery_actions", "type": "array", "required": true},
        {"name": "recovery_status", "type": "string", "required": true},
        {"name": "service_status", "type": "object", "required": true},
        {"name": "enhanced_monitoring", "type": "array", "required": true}
      ],

      "required_integrations": [
        {"system": "Backup", "type": "bidirectional", "protocol": "API", "examples": ["Veeam", "Commvault", "Rubrik"]},
        {"system": "ITSM", "type": "bidirectional", "protocol": "API"},
        {"system": "Monitoring", "type": "write", "protocol": "API", "examples": ["Datadog", "New Relic", "Dynatrace"]}
      ],

      "decision_rules": [
        {"rule_id": "DR-RE-001", "name": "Staged Recovery", "condition": "critical_systems_count > 10", "action": "phased_recovery_approach", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "backup_corrupted", "severity": "critical", "action": "alternative_recovery_method", "notification": ["incident_commander", "cto"]}
      ]
    },

    {
      "id": "agent_10_3_1_1_step7",
      "apqc_id": "10.3.1.1",
      "step_number": 7,
      "step_name": "Post-Incident Review",
      "description": "Conduct post-incident review and implement improvements",
      "purpose": "Learn and improve",
      "business_value": "Continuous improvement",

      "capabilities": ["retrospective_analysis", "lesson_documentation", "control_enhancement", "playbook_update", "metrics_reporting"],

      "input_schema": [
        {"name": "incident_id", "type": "string", "required": true},
        {"name": "incident_timeline", "type": "array", "required": true},
        {"name": "response_effectiveness", "type": "object", "required": true},
        {"name": "stakeholder_feedback", "type": "array", "required": false}
      ],

      "output_schema": [
        {"name": "post_incident_report", "type": "object", "required": true},
        {"name": "lessons_learned", "type": "array", "required": true},
        {"name": "improvement_actions", "type": "array", "required": true},
        {"name": "updated_playbooks", "type": "array", "required": false}
      ],

      "required_integrations": [
        {"system": "ITSM", "type": "bidirectional", "protocol": "API"},
        {"system": "Knowledge Management", "type": "write", "protocol": "API", "examples": ["Confluence", "SharePoint"]},
        {"system": "GRC Platform", "type": "write", "protocol": "API"}
      ],

      "decision_rules": [
        {"rule_id": "DR-PR-001", "name": "Regulatory Notification", "condition": "data_breach AND pii_affected", "action": "initiate_breach_notification", "priority": 1}
      ],

      "error_handlers": [
        {"error_type": "incomplete_documentation", "severity": "medium", "action": "schedule_follow_up_review", "notification": ["incident_manager"]}
      ]
    }
  ],

  "workflow_rules": {
    "entry_criteria": ["incident_detected", "incident_logged"],
    "exit_criteria": ["systems_recovered", "post_incident_review_complete", "improvements_documented"],
    "escalation_path": ["soc_analyst", "incident_commander", "ciso", "executive_crisis_team", "board_notification"]
  },

  "kpis": [
    {"metric": "mean_time_to_detect", "target": "< 1 hour", "measurement": "detection_to_logging_time"},
    {"metric": "mean_time_to_contain", "target": "< 4 hours", "measurement": "logging_to_containment_time"},
    {"metric": "mean_time_to_resolve", "target": "< 24 hours", "measurement": "logging_to_recovery_time"}
  ]
}

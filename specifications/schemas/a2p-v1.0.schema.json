{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://superstandard.org/schemas/a2p/v1.0.json",
  "title": "Agent-to-Platform Protocol (A2P) v1.0",
  "description": "Standard protocol for agents to interact with external platforms, APIs, and services. Handles authentication, rate limiting, capability discovery, and platform-specific integrations.",
  "version": "1.0.0",
  "type": "object",
  "required": ["protocol", "version"],
  "properties": {
    "protocol": {
      "type": "string",
      "const": "A2P"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "operation": {
      "type": "string",
      "enum": [
        "platform_register",
        "platform_discover",
        "authenticate",
        "invoke_service",
        "subscribe",
        "unsubscribe",
        "rate_limit_query",
        "capability_query"
      ]
    },
    "platform_registration": {
      "$ref": "#/$defs/PlatformRegistration"
    },
    "authentication": {
      "$ref": "#/$defs/Authentication"
    },
    "service_invocation": {
      "$ref": "#/$defs/ServiceInvocation"
    },
    "subscription": {
      "$ref": "#/$defs/Subscription"
    },
    "platform_discovery": {
      "$ref": "#/$defs/PlatformDiscovery"
    }
  },
  "$defs": {
    "PlatformRegistration": {
      "type": "object",
      "description": "Register agent with external platform",
      "required": ["platform_id", "agent_id", "registration_type"],
      "properties": {
        "platform_id": {
          "type": "string",
          "description": "Platform identifier (e.g., openai, anthropic, aws, gcp)"
        },
        "platform_name": {"type": "string"},
        "agent_id": {"type": "string"},
        "registration_type": {
          "type": "string",
          "enum": ["api_key", "oauth", "saml", "mutual_tls", "did_auth"],
          "description": "Authentication method"
        },
        "credentials": {
          "type": "object",
          "description": "Platform-specific credentials (encrypted)",
          "properties": {
            "api_key": {"type": "string"},
            "client_id": {"type": "string"},
            "client_secret": {"type": "string"},
            "access_token": {"type": "string"},
            "refresh_token": {"type": "string"},
            "certificate": {"type": "string"},
            "did": {"type": "string"}
          }
        },
        "allowed_operations": {
          "type": "array",
          "description": "Operations agent is authorized to perform",
          "items": {"type": "string"}
        },
        "rate_limits": {
          "type": "object",
          "description": "Rate limits imposed by platform",
          "properties": {
            "requests_per_minute": {"type": "integer"},
            "requests_per_hour": {"type": "integer"},
            "requests_per_day": {"type": "integer"},
            "concurrent_requests": {"type": "integer"},
            "burst_limit": {"type": "integer"}
          }
        },
        "quota": {
          "type": "object",
          "properties": {
            "monthly_credits": {"type": "number"},
            "daily_credits": {"type": "number"},
            "overage_allowed": {"type": "boolean"},
            "overage_rate": {"type": "number"}
          }
        },
        "registered_at": {"type": "string", "format": "date-time"},
        "expires_at": {"type": "string", "format": "date-time"}
      }
    },
    "Authentication": {
      "type": "object",
      "description": "Authenticate with platform",
      "required": ["platform_id", "agent_id", "auth_method"],
      "properties": {
        "platform_id": {"type": "string"},
        "agent_id": {"type": "string"},
        "auth_method": {
          "type": "string",
          "enum": ["api_key", "oauth", "jwt", "saml", "mutual_tls", "did_auth"]
        },
        "credentials": {
          "type": "object",
          "description": "Authentication credentials",
          "additionalProperties": true
        },
        "scope": {
          "type": "array",
          "description": "Requested permissions/scopes",
          "items": {"type": "string"}
        },
        "session_duration": {
          "type": "integer",
          "description": "Requested session duration in seconds"
        },
        "mfa_token": {
          "type": "string",
          "description": "Multi-factor authentication token"
        }
      }
    },
    "ServiceInvocation": {
      "type": "object",
      "description": "Invoke platform service/API",
      "required": ["platform_id", "service_name", "operation"],
      "properties": {
        "platform_id": {"type": "string"},
        "service_name": {
          "type": "string",
          "description": "Service to invoke (e.g., completion, embedding, storage)"
        },
        "operation": {
          "type": "string",
          "description": "Specific operation (e.g., create, read, update, delete)"
        },
        "parameters": {
          "type": "object",
          "description": "Service-specific parameters",
          "additionalProperties": true
        },
        "request_id": {
          "type": "string",
          "description": "Idempotency key"
        },
        "timeout": {
          "type": "integer",
          "description": "Request timeout in milliseconds"
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "max_retries": {"type": "integer"},
            "backoff_strategy": {
              "type": "string",
              "enum": ["linear", "exponential", "fibonacci"]
            },
            "retry_on": {
              "type": "array",
              "items": {"type": "string"},
              "description": "HTTP status codes to retry on"
            }
          }
        },
        "async": {
          "type": "boolean",
          "description": "Whether to invoke asynchronously",
          "default": false
        },
        "callback_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to send result to (for async operations)"
        },
        "metadata": {
          "type": "object",
          "description": "Request metadata (tracing, billing, etc.)",
          "additionalProperties": true
        }
      }
    },
    "Subscription": {
      "type": "object",
      "description": "Subscribe to platform events/webhooks",
      "required": ["platform_id", "event_types", "callback_url"],
      "properties": {
        "platform_id": {"type": "string"},
        "subscription_id": {"type": "string"},
        "event_types": {
          "type": "array",
          "description": "Events to subscribe to",
          "items": {"type": "string"}
        },
        "callback_url": {
          "type": "string",
          "format": "uri",
          "description": "Webhook endpoint"
        },
        "callback_method": {
          "type": "string",
          "enum": ["POST", "PUT", "PATCH"],
          "default": "POST"
        },
        "filter": {
          "type": "object",
          "description": "Event filters",
          "additionalProperties": true
        },
        "delivery_guarantee": {
          "type": "string",
          "enum": ["at_most_once", "at_least_once", "exactly_once"],
          "default": "at_least_once"
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "max_retries": {"type": "integer"},
            "retry_delay": {"type": "integer", "description": "Delay in seconds"}
          }
        },
        "authentication": {
          "type": "object",
          "description": "How platform authenticates to callback",
          "properties": {
            "method": {
              "type": "string",
              "enum": ["hmac", "jwt", "api_key", "mutual_tls"]
            },
            "secret": {"type": "string"}
          }
        },
        "active": {"type": "boolean", "default": true},
        "created_at": {"type": "string", "format": "date-time"},
        "expires_at": {"type": "string", "format": "date-time"}
      }
    },
    "PlatformDiscovery": {
      "type": "object",
      "description": "Discover available platforms and their capabilities",
      "properties": {
        "query": {
          "type": "object",
          "properties": {
            "capabilities": {
              "type": "array",
              "description": "Required capabilities (e.g., llm, vector_db, storage)",
              "items": {"type": "string"}
            },
            "region": {
              "type": "string",
              "description": "Geographic region requirement"
            },
            "compliance": {
              "type": "array",
              "description": "Compliance requirements (e.g., GDPR, HIPAA, SOC2)",
              "items": {"type": "string"}
            },
            "max_cost": {
              "type": "number",
              "description": "Maximum cost per operation"
            },
            "min_availability": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Minimum uptime SLA (0.0-1.0)"
            }
          }
        },
        "results": {
          "type": "array",
          "description": "Matching platforms",
          "items": {
            "type": "object",
            "properties": {
              "platform_id": {"type": "string"},
              "platform_name": {"type": "string"},
              "platform_type": {
                "type": "string",
                "enum": ["llm_provider", "cloud_provider", "data_platform", "api_service", "blockchain"]
              },
              "capabilities": {
                "type": "array",
                "items": {"type": "string"}
              },
              "endpoints": {
                "type": "object",
                "additionalProperties": {"type": "string", "format": "uri"}
              },
              "pricing": {
                "type": "object",
                "properties": {
                  "model": {
                    "type": "string",
                    "enum": ["pay_per_use", "subscription", "freemium", "enterprise"]
                  },
                  "rates": {
                    "type": "object",
                    "additionalProperties": {"type": "number"}
                  }
                }
              },
              "sla": {
                "type": "object",
                "properties": {
                  "availability": {"type": "number"},
                  "latency_p99": {"type": "number"},
                  "support_level": {"type": "string"}
                }
              },
              "compliance_certifications": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "protocol": "A2P",
      "version": "1.0.0",
      "operation": "platform_register",
      "platform_registration": {
        "platform_id": "openai",
        "platform_name": "OpenAI API",
        "agent_id": "apqc_1_0_strategic_001",
        "registration_type": "api_key",
        "credentials": {
          "api_key": "sk-..."
        },
        "allowed_operations": ["completion", "embedding", "fine_tuning"],
        "rate_limits": {
          "requests_per_minute": 60,
          "requests_per_day": 10000
        },
        "quota": {
          "monthly_credits": 1000000,
          "overage_allowed": true,
          "overage_rate": 1.2
        },
        "registered_at": "2025-11-16T14:00:00Z",
        "expires_at": "2026-11-16T14:00:00Z"
      }
    },
    {
      "protocol": "A2P",
      "version": "1.0.0",
      "operation": "invoke_service",
      "service_invocation": {
        "platform_id": "openai",
        "service_name": "completion",
        "operation": "create",
        "parameters": {
          "model": "gpt-4",
          "messages": [
            {"role": "system", "content": "You are a strategic planning assistant"},
            {"role": "user", "content": "Analyze market trends for 2026"}
          ],
          "temperature": 0.7,
          "max_tokens": 2000
        },
        "request_id": "req_abc123",
        "timeout": 30000,
        "retry_policy": {
          "max_retries": 3,
          "backoff_strategy": "exponential",
          "retry_on": ["429", "500", "502", "503"]
        },
        "async": false,
        "metadata": {
          "trace_id": "trace_xyz789",
          "agent_id": "apqc_1_0_strategic_001",
          "task_id": "task_strategic_001"
        }
      }
    },
    {
      "protocol": "A2P",
      "version": "1.0.0",
      "operation": "subscribe",
      "subscription": {
        "platform_id": "aws_s3",
        "subscription_id": "sub_notifications_001",
        "event_types": ["s3:ObjectCreated:*", "s3:ObjectRemoved:*"],
        "callback_url": "https://agent.superstandard.org/webhooks/s3",
        "callback_method": "POST",
        "filter": {
          "bucket": "agent-data-store",
          "prefix": "strategic-reports/"
        },
        "delivery_guarantee": "at_least_once",
        "authentication": {
          "method": "hmac",
          "secret": "webhook_secret_key"
        },
        "active": true,
        "created_at": "2025-11-16T14:00:00Z"
      }
    }
  ]
}

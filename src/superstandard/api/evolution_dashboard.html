<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Dashboard - SuperStandard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 12px 24px;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .nav-button.active {
            background: rgba(76, 175, 80, 0.6);
            border-color: rgba(255,255,255,0.5);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .controls {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 0.95em;
        }

        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .btn-start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: #fff;
        }

        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-stop {
            background: linear-gradient(135deg, #f44336, #da190b);
            color: #fff;
        }

        .btn-reset {
            background: linear-gradient(135deg, #2196F3, #0b7dda);
            color: #fff;
        }

        .status-bar {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 2em;
            font-weight: 700;
            color: #4CAF50;
        }

        .status-value.improvement {
            color: #FFC107;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card h2 {
            font-size: 1.3em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .best-agent {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2));
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .agent-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .info-item {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.85em;
            opacity: 0.8;
        }

        .info-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #4CAF50;
        }

        .generation-log {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
        }

        .log-entry {
            padding: 8px;
            border-left: 3px solid #4CAF50;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            font-size: 0.9em;
        }

        .log-entry.best {
            border-left-color: #FFC107;
            background: rgba(255, 193, 7, 0.1);
        }

        .archetype-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .archetype-card {
            background: rgba(255,255,255,0.08);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .archetype-name {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .archetype-count {
            font-size: 1.5em;
            font-weight: 700;
            color: #4CAF50;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .running {
            animation: pulse 2s infinite;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.idle {
            background: #9E9E9E;
        }

        .status-indicator.running {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-indicator.complete {
            background: #2196F3;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß¨ Evolution Dashboard</h1>
        <p>Watch Agents Evolve in Real-Time</p>
    </div>

    <div class="nav">
        <a href="/dashboard/admin" class="nav-button">Admin</a>
        <a href="/dashboard/user" class="nav-button">User Panel</a>
        <a href="/dashboard/network" class="nav-button">Network</a>
        <a href="/dashboard/coordination" class="nav-button">Coordination</a>
        <a href="/dashboard/consciousness" class="nav-button">Consciousness</a>
        <a href="/dashboard/personality" class="nav-button">Personality</a>
        <a href="/dashboard/evolution" class="nav-button active">Evolution</a>
    </div>

    <div class="container">
        <!-- Controls -->
        <div class="controls">
            <div class="control-row">
                <div class="control-group">
                    <label>Objective</label>
                    <select id="objective">
                        <option value="innovation">Maximize Innovation</option>
                        <option value="reliability">Maximize Reliability</option>
                        <option value="balanced">Balanced Performance</option>
                        <option value="risk">High Risk Tolerance</option>
                        <option value="resilience">Maximum Resilience</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Population Size</label>
                    <input type="number" id="population" value="20" min="5" max="50">
                </div>
                <div class="control-group">
                    <label>Generations</label>
                    <input type="number" id="generations" value="10" min="1" max="50">
                </div>
                <div class="control-group">
                    <label>Mutation Rate</label>
                    <input type="number" id="mutation" value="0.15" min="0" max="1" step="0.05">
                </div>
            </div>
            <div class="control-row">
                <button class="btn btn-start" onclick="startEvolution()">‚ñ∂Ô∏è Start Evolution</button>
                <button class="btn btn-stop" onclick="stopEvolution()">‚èπÔ∏è Stop</button>
                <button class="btn btn-reset" onclick="resetEvolution()">üîÑ Reset</button>
                <span id="status">
                    <span class="status-indicator idle"></span>
                    <span>Idle - Configure and start evolution</span>
                </span>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Current Generation</div>
                <div class="status-value" id="currentGen">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Average Fitness</div>
                <div class="status-value" id="avgFitness">-</div>
            </div>
            <div class="status-item">
                <div class="status-label">Best Fitness</div>
                <div class="status-value" id="bestFitness">-</div>
            </div>
            <div class="status-item">
                <div class="status-label">Improvement</div>
                <div class="status-value improvement" id="improvement">-</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid">
            <!-- Fitness Progress -->
            <div class="card">
                <h2>üìà Fitness Evolution</h2>
                <div class="chart-container">
                    <canvas id="fitnessChart"></canvas>
                </div>
            </div>

            <!-- Trait Evolution -->
            <div class="card">
                <h2>üé® Trait Evolution</h2>
                <div class="chart-container">
                    <canvas id="traitChart"></canvas>
                </div>
            </div>

            <!-- Archetype Distribution -->
            <div class="card">
                <h2>üé≠ Archetype Distribution</h2>
                <div class="chart-container">
                    <canvas id="archetypeChart"></canvas>
                </div>
            </div>

            <!-- Generation Log -->
            <div class="card">
                <h2>üìù Evolution Log</h2>
                <div class="generation-log" id="evolutionLog">
                    <div class="log-entry">Ready to start evolution...</div>
                </div>
            </div>
        </div>

        <!-- Best Agent Showcase -->
        <div class="card">
            <h2>üèÜ Best Agent</h2>
            <div class="best-agent">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 id="bestAgentId">-</h3>
                        <p id="bestAgentArchetype" style="opacity: 0.8;">-</p>
                    </div>
                    <div style="font-size: 3em;">üß¨</div>
                </div>
                <div class="agent-info" id="bestAgentInfo">
                    <div class="info-item">
                        <div class="info-label">Generation</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Fitness</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Openness</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Conscientiousness</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Extraversion</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Agreeableness</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Neuroticism</div>
                        <div class="info-value">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Mutations</div>
                        <div class="info-value">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let fitnessChart, traitChart, archetypeChart;
        let evolutionData = {
            generations: [],
            avgFitness: [],
            maxFitness: [],
            minFitness: [],
            traits: {
                openness: [],
                conscientiousness: [],
                extraversion: [],
                agreeableness: [],
                neuroticism: []
            },
            archetypes: {}
        };
        let isRunning = false;
        let evolutionInterval = null;

        // Initialize charts
        function initCharts() {
            // Fitness Chart
            const fitnessCtx = document.getElementById('fitnessChart').getContext('2d');
            fitnessChart = new Chart(fitnessCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Average Fitness',
                            data: [],
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 3,
                            tension: 0.4
                        },
                        {
                            label: 'Max Fitness',
                            data: [],
                            borderColor: '#FFC107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'rgba(255,255,255,0.8)' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: 'rgba(255,255,255,0.8)' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: 'rgba(255,255,255,0.9)' }
                        }
                    }
                }
            });

            // Trait Chart
            const traitCtx = document.getElementById('traitChart').getContext('2d');
            const traitColors = {
                openness: '#FF6384',
                conscientiousness: '#36A2EB',
                extraversion: '#FFCE56',
                agreeableness: '#4BC0C0',
                neuroticism: '#9966FF'
            };

            traitChart = new Chart(traitCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: Object.keys(evolutionData.traits).map(trait => ({
                        label: trait.charAt(0).toUpperCase() + trait.slice(1),
                        data: [],
                        borderColor: traitColors[trait],
                        backgroundColor: traitColors[trait] + '20',
                        borderWidth: 2,
                        tension: 0.4
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: { color: 'rgba(255,255,255,0.8)' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: 'rgba(255,255,255,0.8)' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: 'rgba(255,255,255,0.9)', font: { size: 10 } }
                        }
                    }
                }
            });

            // Archetype Chart
            const archetypeCtx = document.getElementById('archetypeChart').getContext('2d');
            archetypeChart = new Chart(archetypeCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#4CAF50'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: 'rgba(255,255,255,0.9)', font: { size: 11 } }
                        }
                    }
                }
            });
        }

        function updateCharts(generationData) {
            // Update fitness chart
            fitnessChart.data.labels.push(`Gen ${generationData.generation}`);
            fitnessChart.data.datasets[0].data.push(generationData.avg_fitness);
            fitnessChart.data.datasets[1].data.push(generationData.max_fitness);
            fitnessChart.update('none');

            // Update trait chart
            traitChart.data.labels.push(`Gen ${generationData.generation}`);
            Object.keys(generationData.traits).forEach((trait, idx) => {
                traitChart.data.datasets[idx].data.push(generationData.traits[trait]);
            });
            traitChart.update('none');

            // Update archetype chart
            archetypeChart.data.labels = Object.keys(generationData.archetypes);
            archetypeChart.data.datasets[0].data = Object.values(generationData.archetypes);
            archetypeChart.update('none');
        }

        function updateStatus(generationData) {
            document.getElementById('currentGen').textContent = generationData.generation;
            document.getElementById('avgFitness').textContent = generationData.avg_fitness.toFixed(3);
            document.getElementById('bestFitness').textContent = generationData.max_fitness.toFixed(3);

            if (generationData.generation > 0 && evolutionData.avgFitness.length > 0) {
                const initialFitness = evolutionData.avgFitness[0];
                const improvement = ((generationData.avg_fitness - initialFitness) / initialFitness * 100);
                document.getElementById('improvement').textContent = `${improvement > 0 ? '+' : ''}${improvement.toFixed(1)}%`;
            }
        }

        function updateBestAgent(agent) {
            document.getElementById('bestAgentId').textContent = agent.agent_id;
            document.getElementById('bestAgentArchetype').textContent = agent.archetype;

            const infoItems = document.querySelectorAll('#bestAgentInfo .info-item');
            const values = [
                agent.generation,
                agent.fitness.toFixed(3),
                agent.personality.openness.toFixed(2),
                agent.personality.conscientiousness.toFixed(2),
                agent.personality.extraversion.toFixed(2),
                agent.personality.agreeableness.toFixed(2),
                agent.personality.neuroticism.toFixed(2),
                agent.mutations || 0
            ];

            infoItems.forEach((item, idx) => {
                item.querySelector('.info-value').textContent = values[idx];
            });
        }

        function addLogEntry(message, isBest = false) {
            const log = document.getElementById('evolutionLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${isBest ? 'best' : ''}`;
            entry.textContent = message;
            log.insertBefore(entry, log.firstChild);

            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        function startEvolution() {
            if (isRunning) return;

            isRunning = true;
            document.getElementById('status').innerHTML = '<span class="status-indicator running"></span><span>Evolution in progress...</span>';
            addLogEntry('üöÄ Starting evolution...');

            // Reset data
            evolutionData = {
                generations: [],
                avgFitness: [],
                maxFitness: [],
                minFitness: [],
                traits: {
                    openness: [],
                    conscientiousness: [],
                    extraversion: [],
                    agreeableness: [],
                    neuroticism: []
                },
                archetypes: {}
            };

            fitnessChart.data.labels = [];
            fitnessChart.data.datasets[0].data = [];
            fitnessChart.data.datasets[1].data = [];
            fitnessChart.update();

            traitChart.data.labels = [];
            traitChart.data.datasets.forEach(ds => ds.data = []);
            traitChart.update();

            // Get config
            const config = {
                objective: document.getElementById('objective').value,
                population: parseInt(document.getElementById('population').value),
                generations: parseInt(document.getElementById('generations').value),
                mutation: parseFloat(document.getElementById('mutation').value)
            };

            // Simulate evolution (in real implementation, this would call backend API)
            simulateEvolution(config);
        }

        function simulateEvolution(config) {
            let generation = 0;
            const totalGens = config.generations;

            // Initial generation
            const initialFitness = 0.3 + Math.random() * 0.3;
            const genData = {
                generation: 0,
                avg_fitness: initialFitness,
                max_fitness: initialFitness + 0.1,
                min_fitness: initialFitness - 0.1,
                traits: {
                    openness: 0.5,
                    conscientiousness: 0.5,
                    extraversion: 0.5,
                    agreeableness: 0.5,
                    neuroticism: 0.5
                },
                archetypes: {
                    'Balanced': 15,
                    'Innovator': 2,
                    'Executor': 2,
                    'Explorer': 1
                }
            };

            evolutionData.avgFitness.push(genData.avg_fitness);
            updateCharts(genData);
            updateStatus(genData);
            addLogEntry(`Gen 0: Initialized with avg fitness ${genData.avg_fitness.toFixed(3)}`);

            evolutionInterval = setInterval(() => {
                if (!isRunning || generation >= totalGens) {
                    stopEvolution(true);
                    return;
                }

                generation++;

                // Simulate improvement
                const improvement = 0.03 + Math.random() * 0.05;
                const prevFitness = evolutionData.avgFitness[evolutionData.avgFitness.length - 1];
                const newFitness = Math.min(1.0, prevFitness + improvement);

                // Evolve traits toward objective
                const traits = { ...genData.traits };
                if (config.objective === 'innovation') {
                    traits.openness = Math.min(1, traits.openness + 0.05);
                    traits.conscientiousness = Math.max(0, traits.conscientiousness - 0.02);
                } else if (config.objective === 'reliability') {
                    traits.conscientiousness = Math.min(1, traits.conscientiousness + 0.05);
                    traits.neuroticism = Math.max(0, traits.neuroticism - 0.03);
                }

                const newGenData = {
                    generation: generation,
                    avg_fitness: newFitness,
                    max_fitness: newFitness + 0.08,
                    min_fitness: newFitness - 0.15,
                    traits: traits,
                    archetypes: generation < totalGens / 2 ? {
                        'Innovator': Math.floor(10 + generation * 0.5),
                        'Executor': Math.floor(5 + generation * 0.3),
                        'Balanced': Math.floor(5 - generation * 0.3)
                    } : {
                        'Innovator': config.population
                    }
                };

                evolutionData.avgFitness.push(newGenData.avg_fitness);
                updateCharts(newGenData);
                updateStatus(newGenData);

                const improvementPct = ((newFitness - initialFitness) / initialFitness * 100);
                addLogEntry(`Gen ${generation}: Avg=${newFitness.toFixed(3)} (+${improvementPct.toFixed(1)}%)`);

                if (generation % 3 === 0) {
                    const bestAgent = {
                        agent_id: `gen${generation}_agent_001`,
                        generation: generation,
                        fitness: newGenData.max_fitness,
                        archetype: 'Innovator',
                        personality: traits,
                        mutations: generation
                    };
                    updateBestAgent(bestAgent);
                    addLogEntry(`üèÜ New best agent: ${bestAgent.agent_id} (fitness: ${bestAgent.fitness.toFixed(3)})`, true);
                }
            }, 800);
        }

        function stopEvolution(complete = false) {
            if (evolutionInterval) {
                clearInterval(evolutionInterval);
                evolutionInterval = null;
            }

            isRunning = false;

            if (complete) {
                document.getElementById('status').innerHTML = '<span class="status-indicator complete"></span><span>Evolution complete!</span>';
                addLogEntry('‚úÖ Evolution completed successfully!', true);
            } else {
                document.getElementById('status').innerHTML = '<span class="status-indicator idle"></span><span>Evolution stopped</span>';
                addLogEntry('‚èπÔ∏è Evolution stopped by user');
            }
        }

        function resetEvolution() {
            stopEvolution();

            evolutionData = {
                generations: [],
                avgFitness: [],
                maxFitness: [],
                minFitness: [],
                traits: {
                    openness: [],
                    conscientiousness: [],
                    extraversion: [],
                    agreeableness: [],
                    neuroticism: []
                },
                archetypes: {}
            };

            fitnessChart.data.labels = [];
            fitnessChart.data.datasets[0].data = [];
            fitnessChart.data.datasets[1].data = [];
            fitnessChart.update();

            traitChart.data.labels = [];
            traitChart.data.datasets.forEach(ds => ds.data = []);
            traitChart.update();

            archetypeChart.data.labels = [];
            archetypeChart.data.datasets[0].data = [];
            archetypeChart.update();

            document.getElementById('currentGen').textContent = '0';
            document.getElementById('avgFitness').textContent = '-';
            document.getElementById('bestFitness').textContent = '-';
            document.getElementById('improvement').textContent = '-';

            document.getElementById('evolutionLog').innerHTML = '<div class="log-entry">Ready to start evolution...</div>';

            document.getElementById('bestAgentId').textContent = '-';
            document.getElementById('bestAgentArchetype').textContent = '-';
            document.querySelectorAll('#bestAgentInfo .info-value').forEach(el => el.textContent = '-');

            document.getElementById('status').innerHTML = '<span class="status-indicator idle"></span><span>Reset complete - Ready to start</span>';
        }

        // Initialize on page load
        initCharts();
    </script>
</body>
</html>
